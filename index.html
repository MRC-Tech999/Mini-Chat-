<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mini Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5',
          },
          borderRadius: {
            button: '8px',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-50">

  <!-- Page de connexion -->
  <div id="loginPage" class="flex items-center justify-center h-screen">
    <form id="loginForm" class="bg-white p-6 rounded-lg shadow-md w-full max-w-sm space-y-4">
      <h2 class="text-xl font-bold text-primary text-center">Connexion</h2>
      <input type="text" id="username" placeholder="Nom d'utilisateur" required class="w-full px-4 py-2 border rounded-md" />
      <button type="submit" class="w-full bg-primary text-white px-4 py-2 rounded-button">Entrer</button>
    </form>
  </div>

  <!-- Page principale -->
  <div id="chatPage" class="hidden flex flex-col min-h-screen">
    <header class="bg-white shadow-sm p-4 flex justify-between items-center">
      <h1 class="text-xl font-bold text-primary">Mini Chat</h1>
      <div class="flex items-center gap-2">
        <button id="clearBtn" class="text-sm text-orange-500 border border-orange-500 px-3 py-1 rounded-button">Vider</button>
        <button id="logoutBtn" class="text-sm text-red-500 border border-red-500 px-3 py-1 rounded-button">Déconnexion</button>
      </div>
    </header>

    <main class="flex-1 p-4 space-y-4">
      <div>
        <textarea id="newMsg" placeholder="Quoi de neuf ?" class="w-full p-2 border rounded mb-2 resize-none"></textarea>
        <button onclick="saveMessage(document.getElementById('newMsg').value)" class="bg-primary text-white px-4 py-2 rounded-button">Publier</button>
      </div>
      <div>
        <h2 class="text-lg font-semibold mb-2">Messages récents</h2>
        <div id="messageList" class="space-y-3"></div>
      </div>
    </main>
  </div>

  <script>
    const loginPage = document.getElementById('loginPage');
    const chatPage = document.getElementById('chatPage');
    const loginForm = document.getElementById('loginForm');
    const messageList = document.getElementById('messageList');
    const logoutBtn = document.getElementById('logoutBtn');
    const clearBtn = document.getElementById('clearBtn');

    const user = localStorage.getItem('chatUser');

    if (user) {
      loginPage.classList.add('hidden');
      chatPage.classList.remove('hidden');
      renderMessages();
    } else {
      loginPage.classList.remove('hidden');
      chatPage.classList.add('hidden');
    }

    loginForm?.addEventListener('submit', function (e) {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      if (username) {
        localStorage.setItem('chatUser', username);
        location.reload();
      }
    });

    logoutBtn?.addEventListener('click', () => {
      localStorage.removeItem('chatUser');
      location.reload();
    });

    clearBtn?.addEventListener('click', () => {
      if (confirm("Supprimer tous les messages ?")) {
        localStorage.removeItem('chatMessages');
        renderMessages();
      }
    });

    function saveMessage(content) {
      const trimmed = content.trim();
      if (!trimmed) return;
      const user = localStorage.getItem('chatUser');
      const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
      messages.unshift({
        id: Date.now(),
        user,
        content: trimmed,
        date: new Date().toLocaleString('fr-FR'),
        likes: 0
      });
      localStorage.setItem('chatMessages', JSON.stringify(messages));
      document.getElementById('newMsg').value = '';
      renderMessages();
    }

    function likeMessage(id) {
      const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
      const index = messages.findIndex(m => m.id === id);
      if (index !== -1) {
        messages[index].likes += 1;
        localStorage.setItem('chatMessages', JSON.stringify(messages));
        renderMessages();
      }
    }

    function renderMessages() {
      const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
      messageList.innerHTML = '';
      messages.forEach(msg => {
        const div = document.createElement('div');
        div.className = 'bg-white p-4 rounded-lg shadow-sm';
        div.innerHTML = `
          <h3 class="font-semibold text-sm text-primary">${msg.user}</h3>
          <p class="text-xs text-gray-500">${msg.date}</p>
          <p class="mt-2 text-sm">${msg.content}</p>
          <button onclick="likeMessage(${msg.id})" class="mt-2 text-sm text-blue-600 hover:underline">
            J’aime (${msg.likes})
          </button>
        `;
        messageList.appendChild(div);
      });
    }
  </script>

</body>
</html>
